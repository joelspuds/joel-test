
{% set showExternalNav = true %}
{% set activeNavItem = 'awards' %}
{% set navArea = 'personal' %}
{% set applicationsLink = '#' %}
{% set homeLink = '#' %}
{% set reviewsLink = '#' %}
{% set accountSettingsLink = '' %}
{% set showExternalFurniture = false %}

{% set hideAccountLinks = true %}

{% extends 'layouts/bulma-ufs.layout.njk' %}

{% set isAdminUser = false %}
{% set loggedOut = false %}
{% set allData = allData if allData %}
{% set prototypeData = prototypeData if prototypeData %}
{% set savedSession = savedSession if savedSession %}

{% set userName = prototypeData.userName %}

{% set pageTitle = 'Change requests' + GLOBAL_TAG_TITLE_SUFFIX %}
{% set backLinkContents =  [{url:'/prototypes/change-request/award-overview', text:'Back to award overview'}] %}

{% block content %}
    {% if allData.crStatus == 'accepted' %}
        {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-full') %}
        <div class="govuk-notification-banner govuk-notification-banner--success" role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
            <div class="govuk-notification-banner__header">
                <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">Important</h2>
            </div>
            <div class="govuk-notification-banner__content">
                <p class="govuk-notification-banner__heading">{{ savedSession.requestType }} change request has been approved</p>
                <p class="govuk-body">The request has been approved and you do not need to take any further action.</p>
            </div>
        </div>
        {%- endcall %}
        {%- endcall %}

    {% elseif allData.crStatus == 'rejected' %}
        {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-full') %}

        <div class="govuk-notification-banner govuk-notification-banner--danger" role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
            <div class="govuk-notification-banner__header">
                <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">Important</h2>
            </div>
            <div class="govuk-notification-banner__content">
                <p class="govuk-notification-banner__heading">{{ savedSession.requestType }} request declined</p>
                <p class="govuk-body">You may need to give more information and resubmit the request. <a href="/prototypes/change-request/change-request-detail?crStatus=rejected" class="govuk-link">View change request status</a></p>
            </div>
        </div>
        {%- endcall %}
        {%- endcall %}

    {% elseif savedSession.requestSubmitted %}
        {% call components.bulmaRow() %}
            {% call components.bulmaColumnAny(size='is-full') %}

                <div class="govuk-notification-banner " role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
                    <div class="govuk-notification-banner__header">
                        <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">Important</h2>
                    </div>
                    <div class="govuk-notification-banner__content">
                        <p class="govuk-notification-banner__heading">{{ savedSession.requestType }} request in progress</p>
                        <p class="govuk-body">UKRI will send a response to your Research Office.</p>
                    </div>
                </div>

            {%- endcall %}
        {%- endcall %}
    {% endif %}


    {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-two-thirds') %}
            {{ components.captionHeading(text='Change requests', caption=prototypeData.awardName) }}
        {%- endcall %}
    {%- endcall %}

    {% call components.form(action='#', method='POST',name='submitForm') %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-7') %}

                <p class="govuk-body">Submit a request to change an existing award, and view previous change requests.</p>

                <div class="application-controls govuk-clearfix">
                    <button type="submit" class="govuk-button application-controls__submit" name="submitButton">Create award change request</button>
                </div>

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-7') %}

                {{ components.captionHeading(text='Open change requests', size='s', tag='h2') }}

                {% if savedSession.requestSubmitted %}

                    <table class="govuk-table">
                        <thead>
                        <tr class="govuk-table__header">
                            <th class="govuk-table__header cell-max-35">Change type</th>
                            <th class="govuk-table__header">Requested by</th>
                            <th class="govuk-table__header govuk-table__header--numeric">Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="govuk-table__cell">
                                <a href="/prototypes/change-request/change-request-detail{% if allData.crStatus %}?crStatus={{ allData.crStatus }}{% endif %}" class="govuk-link">{{ savedSession.requestType }}</a>

                            </td>
                            <td class="govuk-table__cell">
                                {{ prototypeData.userName }}
                                <br> <span class="meta">University of Wales</span>
                                <br> <span class="meta govuk-!-font-size-16">on {{ savedSession.createdTimeAndDate }}{#{{ 'dataAndTime' | dateAndTime() }}#}</span>
                            </td>
                            <td class="govuk-table__cell govuk-table__cell--numeric">

                                {% if allData.crStatus == 'accepted' %}
                                    <strong class="govuk-tag govuk-tag--green">Approved</strong>
                                {% elseif allData.crStatus == 'rejected' %}
                                    <strong class="govuk-tag govuk-tag--red">Declined</strong>
                                {% else %}
                                    <strong class="govuk-tag govuk-tag--yellow">Waiting on</strong>
                                {% endif %}

                            </td>
                        </tr>
                        </tbody>
                    </table>

                {% else %}

                    <p class="govuk-body">There are no change requests in progress.</p>

                {% endif %}

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-7') %}

                {{ components.captionHeading(text='Previous change requests', size='s', tag='h2') }}

                <table class="govuk-table">
                    <thead>
                    <tr class="govuk-table__header">
                        <th class="govuk-table__header cell-max-35">Change type</th>
                        <th class="govuk-table__header">Requested by</th>
                        <th class="govuk-table__header govuk-table__header--numeric">Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="govuk-table__cell">
                            <a href="#" class="govuk-link">Change start date</a>
                            {#<p class="govuk-body u-space-y0">
                                <span class="meta">{{ 'dataAndTime' | dateAndTime() }}</span>
                            </p>#}
                        </td>
                        <td class="govuk-table__cell">
                            Dr. Alicia Brook
                            <br> <span class="meta">University of Wales</span>
                            <br> <span class="meta govuk-!-font-size-16">on 11 October 2021 at 2:28 pm</span>
                        </td>
                        <td class="govuk-table__cell govuk-table__cell--numeric">
                            <strong class="govuk-tag govuk-tag--green">Approved</strong>
                        </td>
                    </tr>
                    </tbody>
                </table>

            {%- endcall %}

        {%- endcall %}


    {%- endcall %}
    {% include '../../layouts/partials/user-contact.njk' %}
{% endblock %}
{% block bodyScripts %}

{% endblock %}



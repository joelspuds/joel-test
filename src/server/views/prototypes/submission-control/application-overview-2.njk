{% extends 'layouts/bulma-ufs.layout.njk' %}

{% set pageTitle = 'Application' + ' - UKRI Funding service' %}
{% set storedSpeakerNotes = storedSpeakerNotes if storedSpeakerNotes %}
{% set projectName = projectName if projectName %}
{% set projectDetails = projectDetails if projectDetails %}
{#{% set hasBeenUpdated = hasBeenUpdated if hasBeenUpdated %}
{% set projectDetailsIsComplete = projectDetailsIsComplete if projectDetailsIsComplete %}
{% set eligibilityInputComplete = eligibilityInputComplete if eligibilityInputComplete %}
{% set widerEffectIsComplete = widerEffectIsComplete if widerEffectIsComplete %}
{% set researchExperienceIsComplete = researchExperienceIsComplete if researchExperienceIsComplete %}#}
{% set progressPercentage = progressPercentage if progressPercentage %}
{% set reverseProgressPercentage = reverseProgressPercentage if reverseProgressPercentage %}

{# new stuff for mutliuser #}
{% set userType = userType if userType %}
{% set isShared = isShared if isShared %}
{% set applicationStatus = applicationStatus if applicationStatus %}

{% set hasBeenSubmitted = hasBeenSubmitted if hasBeenSubmitted %}

{% set backLinkContents =  [{url:'/prototypes/submission-control/applications-list', text:'Back to applications'}] %}


{% block content %}

    {% if hasBeenSubmitted %}
        {% call components.bulmaRow() %}
            {% call components.bulmaColumnAny(size='is-full') %}
                <div class="govuk-notification-banner govuk-notification-banner--success" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
                    <div class="govuk-notification-banner__header">
                        <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">Success</h2>
                    </div>
                    <div class="govuk-notification-banner__content">
                        <h3 class="govuk-notification-banner__heading">
                            Application submitted {{ 'dataAndTime' | dateAndTime() }}.
                        </h3>
                        {#<p class="govuk-body">Contact <a class="govuk-notification-banner__link" href="#">example@department.gov.uk</a> if you think there's a problem.</p>#}
                    </div>
                </div>
            {%- endcall %}
        {%- endcall %}
    {% endif %}

    {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-two-thirds') %}
            {{ components.captionHeading(text='Application', caption='APP666: Secrets from the gaps in archaeological history') }}
        {%- endcall %}
    {%- endcall %}

    {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-full', customID='mainContent') %}
            <div class="govuk-tabs" data-module="govuk-tabs">
                <ul class="govuk-tabs__list">
                    <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
                        <a class="govuk-tabs__tab" href="#">Write application</a>
                    </li>
                    <li class="govuk-tabs__list-item">
                        {% if hasBeenSubmitted %}
                        <a class="govuk-tabs__tab" href="#">Read application</a>
                        {% else %}
                            <a class="govuk-tabs__tab" href="/prototypes/submission-control/view-2">Read application</a>
                        {% endif %}
                    </li>
                </ul>
            </div>
        {%- endcall %}
    {%- endcall %}

    {% if hasBeenSubmitted %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-7', extraClass='u-space-t20') %}

                {{ components.captionHeading(text='What happens next?', tag='h2', size='s') }}

                <p class="govuk-body">Your application has been received and, if eligible, will be sent for assessment. Assessors will create shortlists for consideration at a joint panel meeting in November.</p>

                <p class="govuk-body">All applicants will be informed if they have, or have not been selected for the next stage by email between 7-11 December 2021. </p>
                <h2 class="govuk-heading-s">Notification</h2>
                <p class="govuk-body">We will inform you of our decision by email.</p>
                {{ components.captionHeading(text='Can you spare 2 minutes to share your thoughts?', tag='h2', size='s') }}
                <p class="govuk-body">To improve the new UKRI Funding Service, we would really appreciate how you found using it.</p>
                <p class="govuk-body"><a href="#" class="govuk-button">Provide feedback</a></p>
            {%- endcall %}


            {% call components.bulmaColumnAny(size='is-4 is-offset-1') %}

                <div class="application-data">
                    <dl class="application-data__list">
                        <dt class="application-data__key">Funding Opportunity:</dt>
                        <dd class="application-data__value"><a href="#" class="govuk-link" target="_blank">Artefacts of the 21st Century, a dig for knowledge</a></dd>

                        <dt class="application-data__key">Application reference:</dt>
                        <dd class="application-data__value">APP00666</dd>

                        <dt class="application-data__key">Applicant:</dt>
                        <dd class="application-data__value">Rafflesia Arnoldii</dd>

                        <dt class="application-data__key">Application deadline:</dt>
                        <dd class="application-data__value">4 July 2021</dd>
                        <dt class="application-data__key">Funder:</dt>
                        <dd class="application-data__value">AHRC</dd>
                    </dl>
                </div>

            {%- endcall %}

        {%- endcall %}

    {% else %}


        {% call components.bulmaRow() %}

             {% call components.bulmaColumnAny(size='is-7', extraClass='u-space-t20') %}

<div class="application-items">

                 <div class="application-item {% if detailsIsComplete %}application-item--complete{% else %}application-item--incomplete{% endif %} application-item--skinny ">
                     <div class="application-item__contents govuk-clearfix">
                         <div class="application-item__left">{{ components.link(text='1. Details and summary', url='#')}}</div>
                         <div class="application-item__right">
                             {% if detailsIsComplete %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Complete</span>
                             {% else %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Incomplete</span>
                             {% endif %}
                        </div>
                     </div>
                 </div>

                 <div class="application-item {% if caseForSupportIsComplete %}application-item--complete{% else %}application-item--incomplete{% endif %} application-item--skinny ">
                     <div class="application-item__contents govuk-clearfix">
                         <div class="application-item__left">{{ components.link(text='2. Case for support', url='#')}}</div>
                         <div class="application-item__right">
                             {% if caseForSupportIsComplete %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Complete</span>
                             {% else %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Incomplete</span>
                             {% endif %}
                         </div>
                     </div>
                 </div>

                 <div class="application-item {% if resourcesAndCostsIsComplete %}application-item--complete{% else %}application-item--incomplete{% endif %} application-item--skinny ">
                     <div class="application-item__contents govuk-clearfix">
                         <div class="application-item__left">{{ components.link(text='3. Resources and costs', url='#')}}</div>
                         <div class="application-item__right">
                             {% if resourcesAndCostsIsComplete %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Complete</span>
                             {% else %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Incomplete</span>
                             {% endif %}
                         </div>
                     </div>
                 </div>

                 <div class="application-item {% if justificationIsComplete %}application-item--complete{% else %}application-item--incomplete{% endif %} application-item--skinny ">
                     <div class="application-item__contents govuk-clearfix">
                         <div class="application-item__left">{{ components.link(text='4. Justification of resources', url='#')}}</div>
                         <div class="application-item__right">
                             {% if justificationIsComplete %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Complete</span>
                             {% else %}
                                 <span class="application-item__status"><span class="govuk-visually-hidden">This section is </span> Incomplete</span>
                             {% endif %}
                         </div>
                     </div>
                 </div>

</div>

                 <div class="application-controls application-controls--paired-buttons govuk-clearfix u-space-t45">

                     <p class="govuk-body">
                         <strong>Submit application to UKRI.</strong><br>
                         The applicant has marked this application as 100% complete and sent it to your Research Office. If revisions need to be made, it must be returned to the applicant for editing. Otherwise it can be submitted to UKRI for assessment.
                     </p>
                     {% call components.form(action='#', method='POST',name='submitApplication') %}

                         <button type="submit" class="govuk-button application-controls__submit" name="submitButton" {% if progressPercentage != 100 %}disabled{% endif %} value="submitToUKRI">Submit application</button>

                         <button type="submit" class="govuk-button govuk-button--secondary application-controls__submit u-space-x20" name="submitButton"  value="stopShare">Return to applicant</button>
                     {%- endcall %}
                 </div>

            {%- endcall %}

            {% call components.bulmaColumnAny(size='is-4 is-offset-1') %}

                {% if not hasBeenSubmitted %}
                <div class="progress-meter">
                    <div class="progress-meter__text progress-meter__text--back" role="progress-bar" aria-valuenow="27%"><span class="govuk-visually-hidden">Your application is</span> {{ progressPercentage }}% complete</div>
                    <div class="progress-meter__clipper" aria-hidden="true" style="clip-path: inset(0% {{ reverseProgressPercentage }}% 0% 0%); -webkit-clip-path: inset(0% {{ reverseProgressPercentage }}% 0% 0%)">
                        {% if progressPercentage == 100 %}
                            <div class="progress-meter__text progress-meter__text--front"><strong>100% complete</strong></div>
                        {% else %}
                            <div class="progress-meter__text progress-meter__text--front">{{ progressPercentage }}% complete</div>
                        {% endif %}
                    </div>
                </div>
                {%  endif %}
                <div class="application-data">
                    <dl class="application-data__list">
                        <dt class="application-data__key">Funding Opportunity:</dt>
                        <dd class="application-data__value"><a href="#" class="govuk-link" target="_blank">Artefacts of the 21st Century, a dig for knowledge</a></dd>

                        <dt class="application-data__key">Application reference:</dt>
                        <dd class="application-data__value">APP00666</dd>

                        <dt class="application-data__key">Applicant:</dt>
                        <dd class="application-data__value">Rafflesia Arnoldii</dd>

                        <dt class="application-data__key">Application deadline:</dt>
                        <dd class="application-data__value">4 July 2021</dd>
                        <dt class="application-data__key">Funder:</dt>
                        <dd class="application-data__value">AHRC</dd>
                    </dl>
                </div>

            {%- endcall %}

        {%- endcall %}

    {%  endif %}

    {% include '../../layouts/partials/user-contact.njk' %}

{% endblock %}
{% block bodyScripts %}
    <script>
      Zepto(function($){
        $(window).on('load', function() {
          console.log('window loaded');
          $('.govuk-tabs__tab').attr('tabindex', '');
        });
      });
    </script>
{% endblock %}


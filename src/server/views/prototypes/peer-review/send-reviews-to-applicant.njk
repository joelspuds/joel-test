{% extends 'layouts/bulma-ufs.layout.njk' %}
{% set navType = 'admin' %}
{% set isAdminUser = true %}
{% set pageTitle = 'Review and send invitation to respond'  + GLOBAL_TAG_TITLE_SUFFIX %}
{% set backLinkContents =  [{url:'/prototypes/peer-review/manage-reviews', text:'Back to manage reviews'}] %}

{% set personID = personID if personID %}
{% set personName = personName if personName %}

{%  set review1_status = review1_status if review1_status %}
{%  set review4_status = review4_status if review4_status %}
{%  set userName = userName if userName %}
{%  set whichUser = whichUser if whichUser %}

{% block content %}

    {% call components.form(action='#', method='POST',name='invitationToReview') %}

        {% call components.bulmaRow(extraClass='') %}
            {% call components.bulmaColumnAny(size='is-two-thirds') %}
                {{ components.captionHeading(text='Review and send invitation to respond', caption='Name of the application') }}
            {%- endcall %}
        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-9') %}

                {{ components.captionHeading(text='Recipient', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">

                    {% if userName %}
                        {{ userName }}
                    {% else %}
                        Prof Jane Doe
                    {% endif %}

                </p>

                {{ components.captionHeading(text='Subject', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    Reviews of [name_of_application] are now available for you to read and respond
                </p>

                {{ components.captionHeading(text='Message', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    Dear Prof Jane Doe,<br>
                    The closing date to comment on the reviewers’ feedback is 4pm on 4 April 2021. After which, your application will be passed for final assessment and decision.
                </p>

<div class="govuk-form-group">
    {{ components.captionHeading(text='Response deadline', tag='h2', size='s', extraClass='') }}
    {#<h2 class="govuk-fieldset__heading"></h2>#}
    <p class="govuk-body">The standard deadline for assessing reviews is 5 days - unless you want to specify a date.</p>

    <div class="govuk-radios govuk-radios--conditional" data-module="govuk-radios">
        <div class="govuk-radios__item">
            <input class="govuk-radios__input" id="yes" name="acceptRequest" type="radio" value="yes" data-aria-controls="conditional-contact">
            <label class="govuk-label govuk-radios__label" for="yes">Specify a custom date</label>
        </div>
        <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-contact">
            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset" role="group" aria-describedby="deadline-hint">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                        <h3 class="govuk-fieldset__heading">Set alternative deadline date</h3>
                    </legend>
                    <div id="passport-issued-hint" class="govuk-hint">
                        For example, 27 3 2021
                    </div>

                    <div class="govuk-date-input" id="date-stuff">
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label" for="deadlineDay">
                                    Day
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="deadlineDay" name="deadlineDay" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label" for="deadlineMonth">
                                    Month
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="deadlineMonth" name="deadlineMonth" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                        </div>
                        <div class="govuk-date-input__item">
                            <div class="govuk-form-group">
                                <label class="govuk-label govuk-date-input__label" for="deadlineYear">
                                    Year
                                </label>
                                <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="deadlineYear" name="deadlineYear" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="govuk-radios__item">
            <input class="govuk-radios__input" id="no" name="acceptRequest" type="radio" value="no" data-aria-controls="conditional-contact-2">
            <label class="govuk-label govuk-radios__label" for="no">Use standard 5-day deadline</label>
        </div>
    </div>

                {#<div class="govuk-form-group">
                    <fieldset class="govuk-fieldset" role="group" aria-describedby="passport-issued-hint">
                        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                            <h3 class="govuk-fieldset__heading">Response deadline</h3>
                        </legend>
                        <div id="passport-issued-hint" class="govuk-hint">
                            Panel date, for example, 27 3 2021
                        </div>
                        <div class="govuk-date-input" id="passport-issued">
                            <div class="govuk-date-input__item">
                                <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="deadlineDay">
                                        Day
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="deadlineDay" name="deadlineDay" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                            </div>
                            <div class="govuk-date-input__item">
                                <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="deadlineMonth">
                                        Month
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="deadlineMonth" name="deadlineMonth" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                            </div>
                            <div class="govuk-date-input__item">
                                <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="deadlineYear">
                                        Year
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="deadlineYear" name="deadlineYear" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                            </div>
                        </div>

                    </fieldset>
                </div>#}

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-8') %}

                <div class="govuk-character-count" data-module="govuk-character-count" data-maxlength="200">
                    <div class="govuk-form-group ">
                        <label class="govuk-label govuk-label--s govuk-!-font-weight-bold" for="customInviteNotes">Additional text (optional)</label>
                        <div class="govuk-hint">Add additional text that will be included in the response.</div>
                        <textarea class="govuk-textarea govuk-js-character-count" name="customInviteNotes" id="customInviteNotes" rows="8" {% if readOnly %} disabled {% endif %}>{{ caseForSupportNotes }}</textarea>
                        {#<p class="govuk-body u-space-t20"><span id="wordCount" class="govuk-hint govuk-character-count__message" aria-live="polite">You have 250 words remaining</span></p>#}
                    </div>
                </div>

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-9') %}

                <p class="govuk-body disabledText">If the button does not work use the link below or copy and paste it into your browser’s address bar.</p>

                <p class="govuk-body disabledText">
                    Yours sincerely,
                    <br><br>
                    Firstname Lastname<br>
                    Portfolio Manager<br>
                    Name of council, part of UK Research and Innovation<br>
                    Tel: 01454 4545458<br>
                    Email: fisrtname.lastname@name-of-council.org.uk
                </p>
            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-full') %}

                <div class="application-controls govuk-clearfix">
                    <input type="hidden" value="{{ whichUser }}" name="hiddenPersonID">
                    {{ components.button(text='Send invitation', extraClass="application-controls__submit")}}

                    <span class="sub-button">
                        {{ components.link(text='Cancel', url='/prototypes/peer-review/manage-reviews-ready')}}
                    </span>
                </div>

            {%- endcall %}

        {%- endcall %}


    {%- endcall %}

{% endblock %}

{% block bodyScripts %}
    <script src="https://cdn.tiny.cloud/1/phk3goz7y02jvj65em0m21azcq1qr7abduimch9isoe4jkor/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        const counteroutputFoot = document.getElementById('wordCount');
        let words = 0;
        const limit = 250;
        let tinyMCEWordCount;

        tinymce.init({
            selector: '#customInviteNotes',
            height: 240,
            {% if readOnly %} readonly : 1, {% endif %}
            plugins: [
                'advlist autolink lists link image preview anchor',
                'media table paste  wordcount'
            ],
            setup: function(editor) {

                editor.on('keyup', function(e) {
                    tinyMCEWordCount = parseInt(document.getElementsByClassName('tox-statusbar__wordcount')[0].innerHTML.split([' ']));
                    console.log('tinyMCEWordCount = ' + tinyMCEWordCount);
                    words = tinyMCEWordCount;
                    let remainder = limit - words;
                    if (words < limit) {
                        counteroutputFoot.innerHTML = 'You have ' + remainder + ' words remaining';
                    } else {
                        let overCount = words - limit;
                        counteroutputFoot.innerHTML = '<span style="font-weight:700;color:red">You have ' +  overCount + ' words too many</span>';
                    }
                });

                editor.on('init', function(e) {
                    setTimeout(function(){
                        tinyMCEWordCount = parseInt(document.getElementsByClassName('tox-statusbar__wordcount')[0].innerHTML.split([' ']));
                        console.log('tinyMCEWordCount = ' + tinyMCEWordCount);
                        words = tinyMCEWordCount;
                        let remainder = limit - words;
                        counteroutputFoot.innerHTML = 'You have ' + remainder + ' words remaining';
                    }, 500);
                });
            },
            toolbar: 'formatselect | bold italic | bullist numlist | align | indent outdent | link | table |',
            content_css: [
                '//fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i',
                '/stylesheets/tinymce.css'
            ],
            menubar: false,
        });
    </script>
{% endblock %}

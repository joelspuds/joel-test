{% extends 'layouts/bulma-ufs.layout.njk' %}
{% set navType = 'admin' %}
{% set isAdminUser = true %}
{% set pageTitle = 'Invitation to review'  + GLOBAL_TAG_TITLE_SUFFIX %}
{% set backLinkContents =  [{url:'/prototypes/peer-review/application-overview', text:'Back to appliction overview'}] %}

{% set personID = personID if personID %}
{% set personName = personName if personName %}
{% set showResendBanner = showResendBanner if showResendBanner %}


{% block content %}

    {% if showResendBanner %}
        {% call components.bulmaRow(extraClass='') %}
            {% call components.bulmaColumnAny(size='is-full') %}
                <div class="govuk-notification-banner" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
                    <div class="govuk-notification-banner__header">
                        <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                            Important
                        </h2>
                    </div>
                    <div class="govuk-notification-banner__content">
                        <h3 class="govuk-notification-banner__heading">Invite will resend tomorrow</h3>
                        <p class="govuk-body">Invite automatically resends once the 5-day deadline for responses passes. You can <a href="#" class="govuk-link">cancel the invite</a> if required. </p>
                    </div>
                </div>
            {%- endcall %}
        {%- endcall %}
    {% endif %}

    {% call components.form(action='/prototypes/peer-review/invitation-to-review', method='POST',name='invitationToReview') %}

    {% call components.bulmaRow(extraClass='') %}
        {% call components.bulmaColumnAny(size='is-two-thirds') %}
            {{ components.captionHeading(text='Invitation to review', caption='Name of the application') }}
        {%- endcall %}
    {%- endcall %}

    {% call components.bulmaRow() %}

        {% call components.bulmaColumnAny(size='is-9') %}

                {{ components.captionHeading(text='Recipient', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    {{ personName }}
                </p>

                {{ components.captionHeading(text='Subject', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    UKRI Funding Service - invitation to review
                </p>

                {{ components.captionHeading(text='Message', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    UKRI believe that you have the relevant expertise to review applications for this Opportunity.
                </p>

                <p class="govuk-body disabledText">
                    Reviews typically take 4 to 8 hours to complete.
                </p>


                <div class="govuk-form-group">
                    <h2 class="govuk-fieldset__heading govuk-heading-s">Set deadline?</h2>

                    <p class="govuk-body">The standard deadline for reviews is 21 days from accepting an invitation - unless you want to specify a date.</p>
                    <div class="govuk-radios govuk-radios--conditional" data-module="govuk-radios">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="yes" name="acceptRequest" type="radio" value="yes" data-aria-controls="conditional-contact">
                            <label class="govuk-label govuk-radios__label" for="yes">Yes, specify a date</label>
                        </div>
                        <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-contact">
                            <div class="govuk-form-group">
                                <fieldset class="govuk-fieldset" role="group" aria-describedby="deadline-hint">
                                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                                        <h3 class="govuk-fieldset__heading">Set alternative deadline date</h3>
                                    </legend>
                                    <div id="passport-issued-hint" class="govuk-hint">
                                        For example, 27 3 2021
                                    </div>

                                    <div class="govuk-date-input" id="date-stuff">
                                        <div class="govuk-date-input__item">
                                            <div class="govuk-form-group">
                                                <label class="govuk-label govuk-date-input__label" for="deadlineDay">
                                                    Day
                                                </label>
                                                <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="deadlineDay" name="deadlineDay" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                                        </div>
                                        <div class="govuk-date-input__item">
                                            <div class="govuk-form-group">
                                                <label class="govuk-label govuk-date-input__label" for="deadlineMonth">
                                                    Month
                                                </label>
                                                <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="deadlineMonth" name="deadlineMonth" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                                        </div>
                                        <div class="govuk-date-input__item">
                                            <div class="govuk-form-group">
                                                <label class="govuk-label govuk-date-input__label" for="deadlineYear">
                                                    Year
                                                </label>
                                                <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="deadlineYear" name="deadlineYear" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="no" name="acceptRequest" type="radio" value="no" data-aria-controls="conditional-contact-2">
                            <label class="govuk-label govuk-radios__label" for="no">No, use standard 21-day deadline</label>
                        </div>
                    </div>

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-8') %}

                <div class="govuk-character-count" data-module="govuk-character-count" data-maxlength="200">
                    <div class="govuk-form-group ">
                        <label class="govuk-label govuk-label--s govuk-!-font-weight-bold" for="customInviteNotes">Additional text (optional)</label>
                        <div class="govuk-hint">Add additional text that will be included in the invite. Any invite notes saved against each record will also be included.</div>
                        <textarea class="govuk-textarea govuk-js-character-count" name="customInviteNotes" id="customInviteNotes" rows="8" {% if readOnly %} disabled {% endif %}>{{ caseForSupportNotes }}</textarea>
                        <p class="govuk-body u-space-t20"><span id="wordCount" class="govuk-hint govuk-character-count__message" aria-live="polite">You have 250 words remaining</span></p>
                    </div>
                </div>

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-9') %}

                {{ components.captionHeading(text='Opportunity:', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body">
                    <a href="#" class="govuk-link">Development of a Novel Inhibitor of Ricin</a>
                </p>


                {{ components.captionHeading(text='Application title:', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    Name of application
                </p>

                {{ components.captionHeading(text='Team:', tag='h2', size='s', extraClass='disabledText') }}

                <ul class="govuk-list disabledText">
                    <li><strong class="disabledText">Principal investigator:</strong> Prof Giles Dexter, Coventry University</li>
                    <li><strong class="disabledText">Co-investigator:</strong> Prof Ian Charles, Coventry University</li>
                    <li><strong class="disabledText">Researcher:</strong> Dr Maxwell Peterson, Coventry University</li>
                </ul>

                {{ components.captionHeading(text='Grant size:', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    Â£180,000
                </p>

                {{ components.captionHeading(text='Sumamry:', tag='h2', size='s', extraClass='disabledText') }}

                <p class="govuk-body disabledText">
                    The PI proposes a high-impact collaborative research project to develop new inhibitors for ribosome inactivating proteins (RIPs), such as ricin and Shiga toxin. Ricin toxin, produced by the castor bean plant, has a nefarious past. Ricin is a well-known homicidal poison and has been used in several bioterrorist attacks. Shiga toxin is a deadly product of enterobacterial Escherichia coli. RIPs are RNA N-glycosidases that enzymatically remove specific purine residues from the universally conserved sarcin/ricin loop (S/R loop) of large ribosomal RNA, causing cellular death.
                </p>

                <p class="govuk-body disabledText">Phasellus ac risus lectus. Proin quis vehicula metus. Suspendisse eget odio metus. Maecenas vehicula quam ut accumsan dapibus. Phasellus sit amet nibh a lectus commodo viverra in id risus. Maecenas at sem nec dolor consectetur accumsan. Morbi non eros magna. Sed et mauris libero. Donec sollicitudin, risus non pulvinar consectetur, nibh lacus venenatis nunc, eget laoreet libero quam et lacus. Proin eros tortor, tempor quis dui quis, consequat ultricies arcu. Sed congue turpis at elit posuere, quis iaculis elit consequat. In maximus eu mi id euismod.
                </p>

                <p class="govuk-body disabledText">
                    Yours sincerely,
                    <br><br>
                    Firstname Lastname<br>
                    Portfolio Manager<br>
                    Name of council, part of UK Research and Innovation<br>
                    Tel: 01454 4545458<br>
                    Email: fisrtname.lastname@name-of-council.org.uk
                </p>
            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='is-full') %}

                <div class="application-controls govuk-clearfix">
                    <input type="hidden" value="{{ personID }}" name="hiddenPersonID">
                    {{ components.button(text='Send invitation', extraClass="application-controls__submit")}}

                    <span class="sub-button">
                        {{ components.link(text='Cancel', url='/prototypes/peer-review/application-overview')}}
                    </span>
                </div>

            {%- endcall %}

        {%- endcall %}


    {%- endcall %}

{% endblock %}

{% block bodyScripts %}
    <script src="https://cdn.tiny.cloud/1/phk3goz7y02jvj65em0m21azcq1qr7abduimch9isoe4jkor/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script>
        const counteroutputFoot = document.getElementById('wordCount');
        let words = 0;
        const limit = 250;
        let tinyMCEWordCount;

        tinymce.init({
            selector: '#customInviteNotes',
            height: 240,
            {% if readOnly %} readonly : 1, {% endif %}
            plugins: [
                'advlist autolink lists link image preview anchor',
                'media table paste  wordcount'
            ],
            setup: function(editor) {

                editor.on('keyup', function(e) {
                    tinyMCEWordCount = parseInt(document.getElementsByClassName('tox-statusbar__wordcount')[0].innerHTML.split([' ']));
                    console.log('tinyMCEWordCount = ' + tinyMCEWordCount);
                    words = tinyMCEWordCount;
                    let remainder = limit - words;
                    if (words < limit) {
                        counteroutputFoot.innerHTML = 'You have ' + remainder + ' words remaining';
                    } else {
                        let overCount = words - limit;
                        counteroutputFoot.innerHTML = '<span style="font-weight:700;color:red">You have ' +  overCount + ' words too many</span>';
                    }
                });

                editor.on('init', function(e) {
                    setTimeout(function(){
                        tinyMCEWordCount = parseInt(document.getElementsByClassName('tox-statusbar__wordcount')[0].innerHTML.split([' ']));
                        console.log('tinyMCEWordCount = ' + tinyMCEWordCount);
                        words = tinyMCEWordCount;
                        let remainder = limit - words;
                        counteroutputFoot.innerHTML = 'You have ' + remainder + ' words remaining';
                    }, 500);
                });
            },
            toolbar: 'formatselect | bold italic | bullist numlist | align | indent outdent | link | table |',
            content_css: [
                '//fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i',
                '/stylesheets/tinymce.css'
            ],
            menubar: false,
        });
    </script>
{% endblock %}

{% set isAdminUser = false %}
{%  set loggedOut = false %}
{% extends 'layouts/bulma-ufs.layout.njk' %}

{% set pageTitle = 'Spreadsheet example' %}
{#{% set showSpreadsheetscripts = true %}#}

{% block content %}

    {% call components.bulmaRow() %}
        {% call components.bulmaColumnAny(size='is-two-thirds') %}
            {{ components.captionHeading(text='Spreadsheet example') }}
        {%- endcall %}
    {%- endcall %}

    <section class="section" id="mainContent">

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column is-9-desktop is-9-widescreen') %}
                {#{{ components.paragraph(text='Enter your financial data into the spreadsheet below. You can cut and paste directly from an Excel spreadsheet. Paste into', size='l')}}#}

                <p class="govuk-body">
                    {{ components.link(text='Download example data', url='/files/example_spreadsheeet2.xls')}}
                </p>

                {#{{ components.paragraph(text='Select the required cells in Excel and paste into the "spreadsheet" below, then click the <strong>Munge data</strong> button. Contents will be displayed in a JavaScript alert dialogue or open the console (Right click > inspect) to view the captured data as a big array. This data can very easily be sent off to a the server and manipulated programatically.')}}#}

                {{ components.paragraph(text='Select the required cells from any of the tables in the spreadsheet linked above and paste into cell A1 below, then click the <strong>Munge data</strong> button. Contents will be displayed in a table on the following page.')}}

            {%- endcall %}

        {%- endcall %}

        {% call components.bulmaRow() %}

            {% call components.bulmaColumnAny(size='column is-full {#is-9-desktop is-9-widescreen#}') %}

                {% call components.form(action='#', method='POST',name='formSpreadsheet') %}

                    <div id="financialData"></div>

                    <input type="hidden" id="dataHolder" name="dataHolder">
                    <input type="hidden" id="colCount" name="colCount">

                    <div class="application-controls govuk-clearfix u-space-t45">

                        <button type="submit" id="saveTableData" class="govuk-button application-controls__submit">Munge data</button>

                    </div>

                {%- endcall %}

            {%- endcall %}

        {%- endcall %}

    </section>

{% endblock %}


{% block bodyScripts %}
    {# remote #}
    <link href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" media="all" rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js'></script>
    {# local #}
    {#<link href="/stylesheets/handsontable.full.min.css" media="all" rel="stylesheet">
    <script src='/javascripts/handsontable.full.min.js'></script>#}
    <script>
        var ready = (callback) => {
            if (document.readyState != 'loading') callback();
            else document.addEventListener('DOMContentLoaded', callback);
        }
        ready(() => {

            /*let data = [
                ['', '', '', '', '', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', '', '', '', '', '']
            ];*/
            let data = [
                ['',''],
                ['','']
            ];

            let container = document.getElementById('financialData');
            let hot = new Handsontable(container, {
                data: data,
                // data: JSON.parse(JSON.stringify(data)),
                rowHeaders: true,
                colHeaders: true,
                filters: false,
                dropdownMenu: false,
                licenseKey: 'non-commercial-and-evaluation',
                width: 'auto',
                /*columnSummary() {
                    console.log(this.hot.countCols());
                }*/
            });

            console.log(hot.countCols());

            // console.log('handsontable(\'countCols\')' + handsontable('countCols'));

            let saveButton = document.getElementById('saveTableData');
            let dataHolder = document.getElementById('dataHolder');
            let colCount = document.getElementById('colCount');
            let theForm = document.getElementsByTagName('form')[0];
            saveButton.onclick = function(e) {
                e.preventDefault();
                dataHolder.value = data;
                colCount.value = hot.countCols();
                theForm.submit();
                // console.log(dataHolder.value);
                // console.log('HERE IS YOUR EASILY-DIGESTIBLE CSV DATE:');
                // console.log(data);
                // alert('HERE IS YOUR EASILY-DIGESTIBLE CSV DATE:' + '\n' + '\n'  + data);
                // dataHolder
            };

        });
    </script>
{% endblock %}





